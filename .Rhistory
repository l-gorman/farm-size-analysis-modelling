land_cult_q_0.75 = quantile(land_cultivated_ha, probs=c(0.75),na.rm=T),
land_cult_skew = moments::skewness(land_cultivated_ha, na.rm=T),
land_cult_kurtosis = moments::kurtosis(land_cultivated_ha, na.rm=T)
)
fao_level_2_land_cult <- merge(land_cult_summary,
fao_level_2,
by="geo_id",
all.x=T,
all.y=F) %>% tibble::as_tibble()
colSums(is.na(fao_level_2))
y_subn <- c(
"land_cult_mean",
"land_cult_stdev",
"land_cult_med",
"land_cult_iqr",
"land_cult_q_0.25",
"land_cult_q_0.75"
)
x_subn <- x[x %in% colnames(fao_level_2_land_cult)]
fao_level_2_land_cult[c(x_subn,y_subn)] <- lapply(fao_level_2_land_cult[c(x_subn,y_subn)],
function(x){
as.numeric(x)
}) %>% dplyr::bind_cols()
colSums(is.na(fao_level_2_land_cult))
corr_matrix <- round(cor(fao_level_2_land_cult[c(x_subn,y_subn)]),2) %>% tibble::as_tibble()
corr_matrix$var <- colnames(corr_matrix)
corr_matrix <- corr_matrix %>% pivot_longer(cols = colnames(corr_matrix)[colnames(corr_matrix)!="var"])
colnames(corr_matrix) <- c("var1", "var2", "value")
corr_matrix <- corr_matrix[corr_matrix$var1 %in% x_subn==F,]
corr_matrix <- corr_matrix[corr_matrix$var2 %in% y_subn==F,]
ggplot(data = corr_matrix, aes(x=var2, y=var1, fill=value)) +
geom_tile() +
theme_minimal()+
theme(axis.text.x = element_text(angle = 90, vjust = 1,
hjust = 1))
# Reducing layers
FactoMineR::PCA(fao_level_2_land_cult[x_subn], scale.unit=TRUE, ncp=5, graph=T)
table(indicator_data$AEZ_Classes_33)
ggplot(data = land_cult_corr, aes(y=var2, x=value)) +
geom_segment( aes(x=0, xend=value, y=var2, yend=var2), color="black")+
geom_point( size=4, aes(x=value, color=var_group)) +
scale_color_manual(values=colors) +
coord_cartesian(xlim = c(-0.3, 0.3), # This focuses the x-axis on the range of interest
clip = 'off')+
labs(title="Correlations with Land Cultivated (ha)",
x ="Pearsons Correlation Coeff", y ="Landscape predictiors",
color="Variable Class",
caption = "\nLandscape predictors sourced from GAEZ v4 and Google Earth Engine.
Environmental, land-cover, and socio-economic data aggregated to FAO GAUL level 2.
Length growing period and AEZ classes averaged for subnational area.
AEZ simplified 33 class has been used, only 10/33 AEZs featured in the data.
Correlations represent correlation between household level land cultivated (ha)
and aggregated landscape variable.
Outliers have been removed using 99th percentile (>24ha)*
") +
theme(text = element_text(size = 16),
axis.text.y = element_text(colour = land_cult_corr$color)
)
source("~/research/phd/farm-size-modelling-final/farm-size-analysis-ssa/src/exploratory-analysis/correlations_and_distributions.R")
source("~/research/phd/farm-size-modelling-final/farm-size-analysis-ssa/src/exploratory-analysis/correlations_and_distributions.R")
source("~/research/phd/farm-size-modelling-final/farm-size-analysis-ssa/src/exploratory-analysis/correlations_and_distributions.R")
source("~/research/phd/farm-size-modelling-final/farm-size-analysis-ssa/src/exploratory-analysis/correlations_and_distributions.R")
indicator_data <- readr::read_csv("./data/prepped-data/rhomis-ee-gaez.csv")
indicator_data <- indicator_data[!is.na(indicator_data$x_gps_latitude) & !is.na(indicator_data$x_gps_longitude),]
indicator_data_geo <- st_as_sf(indicator_data, coords = c("x_gps_latitude", "x_gps_longitude"),
crs = 4326, agr = "constant", remove = F)
# FAO administrative data
fao_level_2 <- geojson_sf('data/prepped-data/fao_level_2.geojson')
fao_level_2 <- sf::st_as_sf(x = fao_level_2, wkt = "geometry")
fao_level_2_geo <-st_set_crs(fao_level_2,'EPSG:4326')
fao_level_2 <- tibble::as_tibble(fao_level_2)
land_categories <-  readr::read_csv("./data/prepped-data/land_cover_classes.csv")
#
indicator_data <- indicator_data[!is.na(indicator_data$land_cultivated_ha),]
indicator_data <- indicator_data[!is.na(indicator_data$AEZ_Classes_33),]
land_cat_columns <- paste0("land_cat_",c(1:17))
indicator_data[land_cat_columns] <- lapply(indicator_data[land_cat_columns] , function(column){
column[is.na(column)] <- 0
# Dividing the number of pixels by total pixel count for that area
column <- column/indicator_data$pixelCount
return(column)
}) %>% dplyr::bind_cols()
fao_level_2[land_cat_columns] <- lapply(fao_level_2[land_cat_columns] , function(column){
column <- as.numeric(column)
column[is.na(column)] <- 0
# Dividing the number of pixels by total pixel count for that area
column <- column/fao_level_2$pixelCount
return(column)
}) %>% dplyr::bind_cols()
new_land_cat_columns <- land_categories$Tag
colnames(indicator_data)[colnames(indicator_data) %in% land_cat_columns] <- new_land_cat_columns
colnames(fao_level_2)[colnames(fao_level_2) %in% land_cat_columns] <- new_land_cat_columns
colnames(indicator_data)[colnames(indicator_data) == "accessibility_mean"] <-"healthcare_traveltime"
colnames(indicator_data)[colnames(indicator_data) == "b1_mean_mean"] <- "nightlights"
colnames(indicator_data)[colnames(indicator_data) == "population_density_mean_mean"] <- "population_density"
colnames(indicator_data)[colnames(indicator_data) == "elevation_mean"] <- "elevation"
colnames(indicator_data)[colnames(indicator_data) == "NDVI_mean_mean"] <- "ndvi"
colnames(indicator_data)[colnames(indicator_data) == "constant_mean"] <- "topographic_diversity"
colnames(fao_level_2)[colnames(fao_level_2) == "accessibility_mean"] <-"healthcare_traveltime"
colnames(fao_level_2)[colnames(fao_level_2) == "b1_mean_mean"] <- "nightlights"
colnames(fao_level_2)[colnames(fao_level_2) == "population_density_mean_mean"] <- "population_density"
colnames(fao_level_2)[colnames(fao_level_2) == "elevation_mean"] <- "elevation"
colnames(fao_level_2)[colnames(fao_level_2) == "NDVI_mean_mean"] <- "ndvi"
colnames(fao_level_2)[colnames(fao_level_2) == "constant_mean"] <- "topographic_diversity"
indicator_data$geo_id <- paste0(indicator_data$ADM0_CODE, "_",
indicator_data$ADM1_CODE, "_",
indicator_data$ADM2_CODE)
fao_level_2$geo_id <- paste0(fao_level_2$ADM0_CODE, "_",
fao_level_2$ADM1_CODE, "_",
fao_level_2$ADM2_CODE)
outlier_filter <- quantile(indicator_data[["land_cultivated_ha"]], probs = c(0.01,0.99))
table(indicator_data[c("land_cultivated_ha")]==outlier_filter[1]) # 236 with 0 land cult (investigate further)
table(indicator_data[c("land_cultivated_ha")]>outlier_filter[2]) # 201 with land cult greater than 99th percentile (24th)
indicator_data <- indicator_data[indicator_data[c("land_cultivated_ha")] != outlier_filter[1] & indicator_data[c("land_cultivated_ha")] <= outlier_filter[2],]
x <- c("healthcare_traveltime",
"nightlights",
"population_density",
"elevation",
"ndvi",
"topographic_diversity",
"adjusted_length_growing_period",
new_land_cat_columns
)
aez_33 <- grep("AEZ_Classes_33_", colnames(indicator_data), value=T)
y <-c("land_cultivated_ha")
# Looking at subnational indicators vas land cultivated
cor(indicator_data[c(x,aez_33,y)])
indicator_data$hfias_numeric<- NA
indicator_data$hfias_numeric[indicator_data$hfias_status=="severely_fi"] <- 1
indicator_data$hfias_numeric[indicator_data$hfias_status=="moderately_fi"] <- 2
indicator_data$hfias_numeric[indicator_data$hfias_status=="mildly_fi"] <- 3
indicator_data$hfias_numeric[indicator_data$hfias_status=="food_secure"] <- 4
# y <-c("land_cultivated_ha")
y <-c("hfias_numeric")
# Looking at subnational indicators vas land cultivated
cor(indicator_data[c(x,aez_33,y)])
corr_matrix <- round(cor(indicator_data[c(x,aez_33,y)]),2) %>% tibble::as_tibble()
corr_matrix$var <- colnames(corr_matrix)
corr_matrix <- corr_matrix %>% pivot_longer(cols = colnames(corr_matrix)[colnames(corr_matrix)!="var"])
colnames(corr_matrix) <- c("var1", "var2", "value")
land_cult_corr <- corr_matrix[corr_matrix$var1=="land_cultivated_ha", ]
land_cult_corr <- land_cult_corr[land_cult_corr$var2!="land_cultivated_ha",]
land_cult_corr$var2 <- gsub("AEZ_Classes_33_", "",land_cult_corr$var2)
land_cult_corr$var2 <- factor(land_cult_corr$var2, levels=c(x,gsub("AEZ_Classes_33_", "",aez_33)), ordered = T)
land_cult_corr$factor_level <- as.numeric(land_cult_corr$var2)
socio_economic <- c("healthcare_traveltime",
"nightlights",
"population_density")
environmental <- c("elevation",
"ndvi",
"topographic_diversity",
"adjusted_length_growing_period")
land_cat <- new_land_cat_columns
land_cult_corr$var_group <- NA
land_cult_corr$var_group[land_cult_corr$var2 %in% socio_economic] <- "Socio-Economic"
land_cult_corr$var_group[land_cult_corr$var2 %in% environmental] <- "Environmental"
land_cult_corr$var_group[land_cult_corr$var2 %in% land_cat] <- "Land-Cover-Class"
land_cult_corr$var_group[land_cult_corr$var2 %in% gsub("AEZ_Classes_33_", "",aez_33)] <- "Agro-Eco-Zone"
land_cult_corr$var_group <- factor(land_cult_corr$var_group,
levels=c("Agro-Eco-Zone",
"Land-Cover-Class",
"Environmental",
"Socio-Economic"),
ordered=T, )
land_cult_corr <- land_cult_corr[!is.na(land_cult_corr$value),]
colors <- brewer.pal(length(unique(land_cult_corr$var_group)), name="Dark2")
land_cult_corr <- land_cult_corr %>%
mutate(., color = with(., case_when(
(var_group=="Socio-Economic") ~ colors[4],
(var_group=="Environmental")  ~ colors[3],
(var_group=="Land-Cover-Class")  ~ colors[2],
(var_group=="Agro-Eco-Zone")  ~ colors[1]
)))
ggplot(data = land_cult_corr, aes(y=var2, x=value)) +
geom_segment( aes(x=0, xend=value, y=var2, yend=var2), color="black")+
geom_point( size=4, aes(x=value, color=var_group)) +
scale_color_manual(values=colors) +
coord_cartesian(xlim = c(-0.3, 0.3), # This focuses the x-axis on the range of interest
clip = 'off')+
labs(title="Correlations with Land Cultivated (ha)",
x ="Pearsons Correlation Coeff", y ="Landscape predictiors",
color="Variable Class",
caption = "\nLandscape predictors sourced from GAEZ v4 and Google Earth Engine.
Environmental, land-cover, and socio-economic data aggregated to FAO GAUL level 2.
Length growing period and AEZ classes averaged for subnational area.
AEZ simplified 33 class has been used, only 10/33 AEZs featured in the data.
Correlations represent correlation between household level land cultivated (ha)
and aggregated landscape variable.
Outliers have been removed using 99th percentile (>24ha)*
") +
theme(text = element_text(size = 16),
axis.text.y = element_text(colour = land_cult_corr$color)
)
ggplot(data = land_cult_corr, aes(y=var2, x=value)) +
geom_segment( aes(x=0, xend=value, y=var2, yend=var2), color="black")+
geom_point( size=4, aes(x=value, color=var_group))
ggplot(data = land_cult_corr, aes(y=var2, x=value)) +
geom_segment( aes(x=0, xend=value, y=var2, yend=var2), color="black")+
geom_point( size=4, aes(x=value, color=var_group)) +
scale_color_manual(values=colors) +
coord_cartesian(xlim = c(-0.3, 0.3), # This focuses the x-axis on the range of interest
clip = 'off')+
labs(title="Correlations with Land Cultivated (ha)",
x ="Pearsons Correlation Coeff", y ="Landscape predictiors",
color="Variable Class",
caption = "\nLandscape predictors sourced from GAEZ v4 and Google Earth Engine.
Environmental, land-cover, and socio-economic data aggregated to FAO GAUL level 2.
Length growing period and AEZ classes averaged for subnational area.
AEZ simplified 33 class has been used, only 10/33 AEZs featured in the data.
Correlations represent correlation between household level land cultivated (ha)
and aggregated landscape variable.
Outliers have been removed using 99th percentile (>24ha)*
") +
theme(text = element_text(size = 16),
axis.text.y = element_text(colour = land_cult_corr$color)
)
land_cult_corr
# Looking at subnational indicators vas land cultivated
cor(indicator_data[c(x,aez_33,y)])
corr_matrix <- round(cor(indicator_data[c(x,aez_33,y)]),2) %>% tibble::as_tibble()
corr_matrix$var <- colnames(corr_matrix)
corr_matrix <- corr_matrix %>% pivot_longer(cols = colnames(corr_matrix)[colnames(corr_matrix)!="var"])
colnames(corr_matrix) <- c("var1", "var2", "value")
land_cult_corr <- corr_matrix[corr_matrix$var1==y, ]
land_cult_corr <- land_cult_corr[land_cult_corr$var2!=y,]
land_cult_corr
land_cult_corr$var2 <- gsub("AEZ_Classes_33_", "",land_cult_corr$var2)
land_cult_corr$var2 <- factor(land_cult_corr$var2, levels=c(x,gsub("AEZ_Classes_33_", "",aez_33)), ordered = T)
land_cult_corr$factor_level <- as.numeric(land_cult_corr$var2)
socio_economic <- c("healthcare_traveltime",
"nightlights",
"population_density")
environmental <- c("elevation",
"ndvi",
"topographic_diversity",
"adjusted_length_growing_period")
land_cat <- new_land_cat_columns
land_cult_corr$var_group <- NA
land_cult_corr$var_group[land_cult_corr$var2 %in% socio_economic] <- "Socio-Economic"
land_cult_corr$var_group[land_cult_corr$var2 %in% environmental] <- "Environmental"
land_cult_corr$var_group[land_cult_corr$var2 %in% land_cat] <- "Land-Cover-Class"
land_cult_corr$var_group[land_cult_corr$var2 %in% gsub("AEZ_Classes_33_", "",aez_33)] <- "Agro-Eco-Zone"
land_cult_corr$var_group <- factor(land_cult_corr$var_group,
levels=c("Agro-Eco-Zone",
"Land-Cover-Class",
"Environmental",
"Socio-Economic"),
ordered=T, )
land_cult_corr <- land_cult_corr[!is.na(land_cult_corr$value),]
colors <- brewer.pal(length(unique(land_cult_corr$var_group)), name="Dark2")
land_cult_corr <- land_cult_corr %>%
mutate(., color = with(., case_when(
(var_group=="Socio-Economic") ~ colors[4],
(var_group=="Environmental")  ~ colors[3],
(var_group=="Land-Cover-Class")  ~ colors[2],
(var_group=="Agro-Eco-Zone")  ~ colors[1]
)))
ggplot(data = land_cult_corr, aes(y=var2, x=value)) +
geom_segment( aes(x=0, xend=value, y=var2, yend=var2), color="black")+
geom_point( size=4, aes(x=value, color=var_group)) +
scale_color_manual(values=colors) +
coord_cartesian(xlim = c(-0.3, 0.3), # This focuses the x-axis on the range of interest
clip = 'off')+
labs(title="Correlations with Land Cultivated (ha)",
x ="Pearsons Correlation Coeff", y ="Landscape predictiors",
color="Variable Class",
caption = "\nLandscape predictors sourced from GAEZ v4 and Google Earth Engine.
Environmental, land-cover, and socio-economic data aggregated to FAO GAUL level 2.
Length growing period and AEZ classes averaged for subnational area.
AEZ simplified 33 class has been used, only 10/33 AEZs featured in the data.
Correlations represent correlation between household level land cultivated (ha)
and aggregated landscape variable.
Outliers have been removed using 99th percentile (>24ha)*
") +
theme(text = element_text(size = 16),
axis.text.y = element_text(colour = land_cult_corr$color)
)
ggplot(data = land_cult_corr, aes(y=var2, x=value)) +
geom_segment( aes(x=0, xend=value, y=var2, yend=var2), color="black")+
geom_point( size=4, aes(x=value, color=var_group)) +
scale_color_manual(values=colors) +
coord_cartesian(xlim = c(-0.3, 0.3), # This focuses the x-axis on the range of interest
clip = 'off')+
labs(title="Correlations with HFIAS",
x ="Pearsons Correlation Coeff", y ="Landscape predictiors",
color="Variable Class",
caption = "\nLandscape predictors sourced from GAEZ v4 and Google Earth Engine.
Environmental, land-cover, and socio-economic data aggregated to FAO GAUL level 2.
Length growing period and AEZ classes averaged for subnational area.
AEZ simplified 33 class has been used, only 10/33 AEZs featured in the data.
Correlations represent correlation between household level land cultivated (ha)
and aggregated landscape variable.
Outliers have been removed using 99th percentile (>24ha)*
") +
theme(text = element_text(size = 16),
axis.text.y = element_text(colour = land_cult_corr$color)
)
indicator_data$ppi_likelihood
table(is.na(indicator_data))
table(is.na(indicator_data$ppi_limit))
table(is.na(indicator_data$ppi_likelihood))
ggplot(data = land_cult_corr, aes(y=var2, x=value)) +
geom_segment( aes(x=0, xend=value, y=var2, yend=var2), color="black")+
geom_point( size=4, aes(x=value, color=var_group)) +
scale_color_manual(values=colors) +
coord_cartesian(xlim = c(-0.4, 0.4), # This focuses the x-axis on the range of interest
clip = 'off')+
labs(title="Correlations with HFIAS",
x ="Pearsons Correlation Coeff", y ="Landscape predictiors",
color="Variable Class",
caption = "\nLandscape predictors sourced from GAEZ v4 and Google Earth Engine.
Environmental, land-cover, and socio-economic data aggregated to FAO GAUL level 2.
Length growing period and AEZ classes averaged for subnational area.
AEZ simplified 33 class has been used, only 10/33 AEZs featured in the data.
Correlations represent correlation between household level land cultivated (ha)
and aggregated landscape variable.
Outliers have been removed using 99th percentile (>24ha)*
") +
theme(text = element_text(size = 16),
axis.text.y = element_text(colour = land_cult_corr$color)
)
brm_anov_vpc %>%
gather() %>%
ggplot(aes(y = key, x = value)) +
stat_halfeye(aes(fill = after_stat(level))) +
scale_fill_brewer(na.translate = FALSE) +
labs(y="", x="VPC",title = "Variance Partition Coefficients for 3 Level Hierarchical Model",subtitle=paste0("Levels: ",model_name),
caption = "Points represent estimates.\nThicker lines represent standard error.\n Thin lines represent 95% credible intervals")+
scale_y_discrete(name="VPC",
breaks=c("sd_ADM0_NAME__Intercept", "sd_ADM0_NAME:ADM2_CODE__Intercept", "sd_ADM0_NAME:ADM2_CODE:village__Intercept", "sigma"),
labels=c("Between Country", "Between Subcounty", "Between Village", "Unexplained\nVariance"))
source("~/research/phd/farm-size-modelling-final/farm-size-analysis-ssa/src/exploratory-analysis/correlations_and_distributions.R")
ggplot(data = land_cult_corr, aes(y=var2, x=value)) +
geom_segment( aes(x=0, xend=value, y=var2, yend=var2), color="black")+
geom_point( size=2, aes(x=value), color="Orange") +
coord_cartesian(xlim = c(-0.3, 0.3), # This focuses the x-axis on the range of interest
clip = 'off')+
labs(title="Correlations with Land Cultivated (ha)",
x ="Pearsons Correlation Coeff", y ="Agro-Ecological Zone",
caption = "\nAEZ zones sourced from GAEZ v4 (simplified 33 class).
Households in the dataset covered 10 out of the 33 zones.
**Outliers have been removed using 99th percentile (>24ha)
")
ggplot(data = land_cult_corr, aes(y=var2, x=value)) +
geom_segment( aes(x=0, xend=value, y=var2, yend=var2), color="black")+
geom_point( size=4, aes(x=value, color=var_group)) +
scale_color_manual(values=colors) +
coord_cartesian(xlim = c(-0.4, 0.4), # This focuses the x-axis on the range of interest
clip = 'off')+
labs(title="Correlations with HFIAS",
x ="Pearsons Correlation Coeff", y ="Landscape predictiors",
color="Variable Class",
caption = "\nLandscape predictors sourced from GAEZ v4 and Google Earth Engine.
Environmental, land-cover, and socio-economic data aggregated to FAO GAUL level 2.
Length growing period and AEZ classes averaged for subnational area.
AEZ simplified 33 class has been used, only 10/33 AEZs featured in the data.
Correlations represent correlation between household level land cultivated (ha)
and aggregated landscape variable.
Outliers have been removed using 99th percentile (>24ha)*
") +
theme(text = element_text(size = 16),
axis.text.y = element_text(colour = land_cult_corr$color)
)
indicator_data
colnames(indicator_data)
corr_hh <- round(cor(indicator_data[c(x_hh,y)]),2) %>% tibble::as_tibble()
# Corellation with Household Level
x_hh <- c("hh_size_mae",
"land_cultivated_ha",
# Corellation with Household Level
x_hh <- c("hh_size_mae",
"livestock_tlu",
"land_cultivated_ha",
"ppi_likelihood")
corr_hh <- round(cor(indicator_data[c(x_hh,y)]),2) %>% tibble::as_tibble()
# Corellation with Household Level
x_hh <- c("hh_size_mae",
"livestock_tlu",
"land_cultivated_ha",
"ppi_likelihood")
corr_hh <- round(cor(indicator_data[c(x_hh,y)]),2) %>% tibble::as_tibble()
corr_hh
# Corellation with Household Level
x_hh <- c("hh_size_mae",
"livestock_tlu",
"land_cultivated_ha",
"ppi_likelihood")
corr_hh <- round(cor(indicator_data[c(x_hh,y)]),2) %>% tibble::as_tibble()
corr_hh$var <- colnames(corr_hh)
corr_hh <- corr_hh %>% pivot_longer(cols = colnames(corr_hh)[colnames(corr_hh)!="var"])
colnames(corr_hh) <- c("var1", "var2", "value")
corr_hh
corr_hh <- corr_hh[corr_hh$var1==y, ]
corr_hh <- corr_hh[corr_hh$var2!=y,]
corr_hh
y
test_df <- indicator_data[c(x_hh,y)]
complete.cases(test_df)
table(complete.cases(test_df))
test_df <- indicator_data[c(x_hh,y)]
test_df <- indicator_data[complete.cases(test_df)]
# Corellation with Household Level
x_hh <- c("hh_size_mae",
"livestock_tlu",
"land_cultivated_ha",
"ppi_likelihood")
test_df <- indicator_data[c(x_hh,y)]
test_df <- indicator_data[complete.cases(test_df),]
corr_hh <- round(cor(indicator_data[c(x_hh,y)]),2) %>% tibble::as_tibble()
corr_hh <- round(cor(test_df),2) %>% tibble::as_tibble()
test_df
# Corellation with Household Level
x_hh <- c("hh_size_mae",
"livestock_tlu",
"land_cultivated_ha",
"ppi_likelihood")
test_df <- indicator_data[c(x_hh,y)]
test_df <- test_df[complete.cases(test_df),]
corr_hh <- round(cor(test_df),2) %>% tibble::as_tibble()
corr_hh
corr_hh$var <- colnames(corr_hh)
corr_hh <- corr_hh %>% pivot_longer(cols = colnames(corr_hh)[colnames(corr_hh)!="var"])
colnames(corr_hh) <- c("var1", "var2", "value")
corr_hh <- corr_hh[corr_hh$var1==y, ]
corr_hh <- corr_hh[corr_hh$var2!=y,]
corr_hh
setwd("../data-preperation/")
indicator_data <- readr::read_csv("data/raw-data/rhomis/indicator_data.csv", na=c("-999","NA", "n/a"))
table(is.na(indicator_data$land_cultivated_ha))
rhomis_data <- readr::read_csv("data/raw-data/rhomis/processed_data.csv", na=c("-999","NA", "n/a"))
table(is.na(rhomis_data$x_gps_latitude))
table(is.na(rhomis_data$x_gps_latitude)& is.na(indicator_data$land_cultivated_ha))
table(is.na(rhomis_data$x_gps_latitude) | is.na(indicator_data$land_cultivated_ha))
rhomis_data[is.na(rhomis_data$x_gps_latitude) | is.na(indicator_data$land_cultivated_ha)),]
table(indicator_data$iso_country_code[is.na(rhomis_data$x_gps_latitude) | is.na(indicator_data$land_cultivated_ha)])
setwd("../farm-size-analysis-ssa/")
indicator_data <- readr::read_csv(paste0(opt$data,"/prepped-data/rhomis-ee-gaez.csv"))
opt <- list(
iter=2000,
warmup=1000,
data="./data/",
output="./outputs/gaussian_location/",
ncores=4
)
run_model <- function(data,levels, quantile=NULL, sigma, iter, warmup,ncores ){
levels_args <- paste0(levels,collapse="/")
temp_formula <- paste0("hfias_numeric ~ 1 + (1|",levels_args,")")
if (sigma==F & is.null(quantile)){
final_formula <- bf(temp_formula)
family <- gaussian()
}
if (sigma==T & is.null(quantile)){
sigma_formula <- paste0("sigma ~ 1 + (1|",levels_args,")")
final_formula <- bf(temp_formula, sigma_formula)
family <- gaussian()
}
if (!is.null(quantile)){
if (quantile>0 & quantile < 1 & sigma==F){
final_formula <- bf(temp_formula, quantile=quantile)
family <- asym_laplace()
}
}
if (!is.null(quantile)){
if (quantile>0 & quantile < 1 & sigma==T){
sigma_formula <- paste0("sigma ~ 1 + (1|",levels_args,")")
final_formula <- bf(temp_formula, sigma_formula,quantile=quantile)
family <- asym_laplace()
}
}
result <- brms::brm(
formula=final_formula,
data = indicator_data,
family=family,
cores = ncores,
warmup = warmup,
iter=iter
)
return(result)
}
indicator_data <- readr::read_csv(paste0(opt$data,"/prepped-data/rhomis-ee-gaez.csv"))
indicator_data <- indicator_data[!is.na(indicator_data$x_gps_latitude) & !is.na(indicator_data$x_gps_longitude),]
indicator_data <- indicator_data[!is.na(indicator_data$village),]
indicator_data$fies_score
table(!is.na(indicator_data$hfias_status))
indicator_data$hfias_numeric<- NA
indicator_data$hfias_numeric[indicator_data$hfias_status=="severely_fi"] <- 1
indicator_data$hfias_numeric[indicator_data$hfias_status=="moderately_fi"] <- 2
indicator_data$hfias_numeric[indicator_data$hfias_status=="mildly_fi"] <- 3
indicator_data$hfias_numeric[indicator_data$hfias_status=="food_secure"] <- 4
nrow(indicator_data)
level_combos <- list(
# c("ADM0_NAME"),
# c("ADM0_NAME","ADM1_CODE"),
# c("ADM0_NAME","ADM1_CODE","ADM2_CODE"),
# c("ADM0_NAME","ADM1_CODE","ADM2_CODE","village"),
c("ADM2_CODE","village")
)
level_combos
data
unique(indicator_data$iso_country_code)
country_codes <- unique(indicator_data$iso_country_code)
country_codes
level_combo
is.na(indicator_data$iso_country_code)
table(is.na(indicator_data$iso_country_code))
country_codes
length( sbatch src/bc-run-scripts/run_brms_anova_location_per_country.sh  -i 2000 -w 1000 -n 4 -o brms_anova_food_sec_06_03_2023)
length(country_codes)
table(indicator_data$ADM2_CODE)
length(table(indicator_data$ADM2_CODE))
table(unique(indicator_data$village))
length(unique(indicator_data$village))
